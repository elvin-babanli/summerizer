{% extends "base.html" %}
{% block content %}
<section class="layout">

  <!-- LEFT: Sources -->
  <aside class="pane glass">
    <h2 class="section-title">Sources</h2>

    <form action="{{ url_for('upload') }}" method="post" enctype="multipart/form-data" class="uploader">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
      <label class="dropzone" for="filePicker">
        <div class="dz-icon">⬆</div>
        <div class="dz-copy">
          <b>Drop files here</b>
          <span>or click to browse</span>
          <div class="muted">PDF, DOCX, TXT · up to {{ limits.max_files }} files</div>
        </div>
      </label>
      <input id="filePicker" type="file" name="files" multiple accept=".pdf,.docx,.txt" />
      <div class="row right">
        <button class="btn primary" type="submit">Upload</button>
      </div>
    </form>

    <div class="stats">
      <div class="kpi">
        <span class="k">Files</span><span class="v">{{ stats.files }}</span>
      </div>
      <div class="kpi">
        <span class="k">Pages</span><span class="v">{{ stats.pages }}</span>
      </div>
      <div class="kpi">
        <span class="k">Size</span>
        <span class="v">{{ (stats.bytes/(1024*1024))|round(2) }} MB</span>
      </div>
    </div>

    <div class="filelist">
      {% if files and files|length > 0 %}
        <ul>
          {% for f in files %}
          <li class="file-row">
            <div class="file-meta">
              <div class="file-name" title="{{ f.name }}">{{ f.name }}</div>
              <div class="chips">
                <span class="chip">{{ f.ext }}</span>
                <span class="chip">{{ f.pages }}p</span>
                <span class="chip">{{ (f.size_bytes/(1024*1024))|round(2) }}MB</span>
              </div>
            </div>
            <form action="{{ url_for('remove', fid=f.id) }}" method="post">
              <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
              <button class="btn danger tiny" type="submit">remove</button>
            </form>
          </li>
          {% endfor %}
        </ul>
      {% else %}
        <div class="muted tiny">No files uploaded yet.</div>
      {% endif %}
    </div>
  </aside>

  <!-- RIGHT: Options + Result -->
  <section class="pane glass">
    <h2 class="section-title">Task & Options</h2>

    <form action="{{ url_for('generate') }}" method="post" class="options">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

      <!-- Task segmented -->
      <div class="segmented">
        <label class="seg">
          <input type="radio" name="task" value="summary" {{ 'checked' if options.task=='summary' }} />
          <span>Summary</span>
        </label>
        <label class="seg">
          <input type="radio" name="task" value="detailed" {{ 'checked' if options.task=='detailed' }} />
          <span>Detailed</span>
        </label>
        <label class="seg">
          <input type="radio" name="task" value="study" {{ 'checked' if options.task=='study' }} />
          <span>Study notes</span>
        </label>
        <label class="seg">
          <input type="radio" name="task" value="presentation" {{ 'checked' if options.task=='presentation' }} />
          <span>Presentation</span>
        </label>
      </div>

      <!-- Grid -->
      <div class="grid">
        <label class="field">
          <span class="label">Words</span>
          <input class="control" type="number" name="words" min="200" max="20000" step="50" value="{{ options.words }}">
        </label>

        <label class="field">
          <span class="label">Language</span>
          <div class="select-wrap">
            <select class="control select" name="language">
              {% for lang in languages %}
              <option value="{{ lang }}" {{ 'selected' if options.language==lang }}>{{ lang }}</option>
              {% endfor %}
            </select>
            <span class="select-caret">▾</span>
          </div>
        </label>

        <label class="field">
          <span class="label">Output</span>
          <div class="select-wrap">
            <select class="control select" name="output">
              <option value="pdf"  {{ 'selected' if options.output=='pdf'  }}>PDF</option>
              <option value="docx" {{ 'selected' if options.output=='docx' }}>Word</option>
              <option value="txt"  {{ 'selected' if options.output=='txt'  }}>TXT</option>
            </select>
            <span class="select-caret">▾</span>
          </div>
        </label>
      </div>

      <label class="field">
        <span class="label">User notes</span>
        <textarea class="control textarea" name="notes" rows="6" placeholder="Questions to be answered strictly from your uploads...">{{ options.notes }}</textarea>
      </label>

      <div class="row right">
        <button class="btn primary" type="submit">Generate</button>
      </div>
    </form>

    <div class="divider"></div>

    <div class="result">
      <div class="result-head">
        <h3>Result</h3>
        <form action="{{ url_for('export') }}" method="post">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
          <button class="btn success" type="submit">Save & Download</button>
      </div>
      <!-- resize none for sure -->
      <textarea name="result_text" class="editor" style="resize:none" spellcheck="false" placeholder="Result will appear here after generation...">{{ result_text }}</textarea>
        </form>
    </div>
  </section>
</section>
{% endblock %}







<!--
 ██████╗  █████╗ ██████╗  █████╗ ██████╗  █████╗  ██████╗                                                    
██╔═══██╗██╔══██╗██╔══██╗██╔══██╗██╔══██╗██╔══██╗██╔════╝                                                    
██║   ██║███████║██████╔╝███████║██████╔╝███████║██║  ███╗                                                   
██║▄▄ ██║██╔══██║██╔══██╗██╔══██║██╔══██╗██╔══██║██║   ██║                                                   
╚██████╔╝██║  ██║██║  ██║██║  ██║██████╔╝██║  ██║╚██████╔╝                                                   
 ╚══▀▀═╝ ╚═╝  ╚═╝╚═╝  ╚═╝╚═╝  ╚═╝╚═════╝ ╚═╝  ╚═╝ ╚═════╝                                                    
                                                                                                             
 █████╗ ███████╗███████╗██████╗ ██████╗  █████╗ ██╗   ██╗ ██████╗ █████╗ ███╗   ██╗██████╗ ██╗██████╗     ██╗
██╔══██╗╚══███╔╝██╔════╝██╔══██╗██╔══██╗██╔══██╗╚██╗ ██╔╝██╔════╝██╔══██╗████╗  ██║██╔══██╗██║██╔══██╗    ██║
███████║  ███╔╝ █████╗  ██████╔╝██████╔╝███████║ ╚████╔╝ ██║     ███████║██╔██╗ ██║██║  ██║██║██████╔╝    ██║
██╔══██║ ███╔╝  ██╔══╝  ██╔══██╗██╔══██╗██╔══██║  ╚██╔╝  ██║     ██╔══██║██║╚██╗██║██║  ██║██║██╔══██╗    ╚═╝
██║  ██║███████╗███████╗██║  ██║██████╔╝██║  ██║   ██║   ╚██████╗██║  ██║██║ ╚████║██████╔╝██║██║  ██║    ██╗
╚═╝  ╚═╝╚══════╝╚══════╝╚═╝  ╚═╝╚═════╝ ╚═╝  ╚═╝   ╚═╝    ╚═════╝╚═╝  ╚═╝╚═╝  ╚═══╝╚═════╝ ╚═╝╚═╝  ╚═╝    ╚═╝
-->





